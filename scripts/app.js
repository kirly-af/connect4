(function(){window.connect4={}}).call(this),function(){var t=function(t,n){function a(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return a.prototype=n.prototype,t.prototype=new a,t.__super__=n.prototype,t},e={}.hasOwnProperty;connect4.Game=function(e){function n(t,e){n.__super__.constructor.call(this,window.innerWidth,window.innerHeight,Phaser.AUTO,t,{preload:function(t){return function(){return t.onPreload()}}(this),create:function(t){return function(){return t.onCreate()}}(this),resize:function(t){return function(){return t.onResize()}}(this)}),this.gameData={logic:e,finished:!1,ratio:1,offsets:{grid:90,gridcolumn:63,disc:255,column:256},pos:{x:0,y:0}}}return t(n,e),n.prototype.discPut=function(t,e,n,a){var i,o;return null==a&&(a="discs"),i=this.gameData.offsets.grid+this.gameData.offsets.disc*t,o=this.gameData.offsets.grid+this.gameData.offsets.disc*(5-e),this.gameData[a].create(i,o,n)},n.prototype.reset=function(){var t;for(t=this.gameData.discs.children;0!==t.length;)t.pop().destroy();this.gameData.finished=!1},n.prototype.onPreload=function(){return this.load.image("grid","assets/images/grid.png"),this.load.image("empty","assets/images/empty.png"),this.load.image("p1","assets/images/player1.png"),this.load.image("p2","assets/images/player2.png"),this.load.image("column","assets/images/column.png"),this.load.image("selected","assets/images/selected.png"),this.load.image("pause","assets/images/pause.png"),this.load.image("undo","assets/images/undo.png"),this.load.image("help","assets/images/help.png")},n.prototype.pauseClicked=function(){return this.gameData.logic.pause()},n.prototype.undoClicked=function(){var t;return this.gameData.logic.undo(),t=this.gameData.discs.children.pop(),null!=t?t.destroy():void 0},n.prototype.helpClicked=function(){return this.gameData.logic.help()},n.prototype.onCreate=function(){var t,e,n,a,i;for(this.scale.scaleMode=Phaser.ScaleManager.RESIZE,this.stage.backgroundColor="#87CEEB",this.gameData.grid=this.add.group(),this.gameData.grid.create(0,0,"grid"),t=function(t){return function(e){var n,a,i;for(i=[],n=a=0;6>=a;n=++a)i.push(t.discPut(n,e,"empty","grid"));return i}}(this),n=a=0;5>=a;n=++a)t(n);for(this.gameData.discs=this.add.group(),this.gameData.selected=this.add.group(),this.gameData.transp=this.gameData.selected.create(this.columnPos(3),50,"selected"),this.gameData.columns=this.add.group(),e=i=0;6>=i;e=++i)this.columnsCreate(e);this.gameData.buttons=this.add.group(),this.gameData.buttons.add(this.add.button(10,10,"pause",this.pauseClicked,this)),this.gameData.buttons.add(this.add.button(10,210,"undo",this.undoClicked,this)),this.gameData.buttons.add(this.add.button(10,410,"help",this.helpClicked,this)),this.gameData.buttons.alpha=.6,this.onResize()},n.prototype.onResize=function(){var t;return t=function(t){return function(e,n){return null==n&&(n=!0),e.scale.setTo(t.gameData.ratio,t.gameData.ratio),n===!0?(e.x=t.gameData.pos.x,e.y=t.gameData.pos.y):void 0}}(this),this.updateRatio(),this.updatePosition(),t(this.gameData.buttons,!1),t(this.gameData.selected),t(this.gameData.grid),t(this.gameData.discs),t(this.gameData.columns),this.scale.refresh()},n.prototype.columnPos=function(t){return Math.ceil(this.gameData.offsets.gridcolumn+this.gameData.offsets.column*t)},n.prototype.columnHover=function(t){return this.gameData.transp.x=this.columnPos(t.i)},n.prototype.columnClicked=function(t){return this.gameData.finished?void 0:(this.gameData.finished=this.gameData.logic.play(t),this.gameData.finished?window.setTimeout(function(t){return function(){return t.gameData.logic.stop()}}(this),300):void 0)},n.prototype.columnsCreate=function(t){var e,n,a;return a=this.columnPos(t),e=this.add.button(a,0,"column",this.columnClicked,this),e.inputEnabled=!0,this.gameData.columns.add(e),e.i=t,n=function(t){return function(e,n){return t.columnHover(e,n)}}(this),e.events.onInputOver.add(n,this)},n.prototype.getGrid=function(){return null==this.gameData.gridImage&&(this.gameData.gridImage=this.cache.getImage("grid")),this.gameData.gridImage},n.prototype.updatePosition=function(){var t,e,n;return t=this.getGrid(),e=Math.ceil(this.gameData.ratio*t.width),n=Math.ceil(this.gameData.ratio*t.height),this.gameData.pos.x=Math.ceil((window.innerWidth-e)/2),this.gameData.pos.y=Math.ceil((window.innerHeight-n)/2)},n.prototype.updateRatio=function(){var t,e,n;return t=this.getGrid(),e=window.innerWidth/t.width,n=window.innerHeight/t.height,this.gameData.ratio=n>e?e:n},n}(Phaser.Game)}.call(this),function(){var t,e,n,a,i,o,s,r,c,u,h,d,g,l,p,m;e=7,n=6,t=["#AD9008","#AD0808"],g=function(){r(),o(),connect4.game=new connect4.Game("game-container",{play:h,pause:u,stop:l,undo:p,help:i})},o=function(){var t;connect4.player=1,connect4.grid=function(){var a,i,o;for(o=[],t=a=1,i=e;i>=1?i>=a:a>=i;t=i>=1?++a:--a)o.push(function(){var e,a,i;for(i=[],t=e=1,a=n;a>=1?a>=e:e>=a;t=a>=1?++e:--e)i.push(0);return i}());return o}(),connect4.cache=function(){var n,a,i;for(i=[],t=n=1,a=e;a>=1?a>=n:n>=a;t=a>=1?++n:--n)i.push(0);return i}(),connect4.turns=[],connect4.finished=!1,connect4.count=0},m=function(t,e){var n,i,o,s;for(s=[{x:0,y:1},{x:1,y:0},{x:1,y:1},{x:-1,y:1}],i=0,o=s.length;o>i;i++)n=s[i],connect4.finished=a(t,e,n.x,n.y);return connect4.finished},h=function(t){var a,i;return a=t.i,0===connect4.grid[a][n-1]&&(i=connect4.cache[a],connect4.game.discPut(a,i,"p"+connect4.player),connect4.grid[a][i]=connect4.player,connect4.cache[a]+=1,c(a,i),connect4.count+=1),m(a,i)||connect4.count===e*n},u=function(){return jQuery("#pause-modal").modal({keyboard:!1})},i=function(){return jQuery("#help-modal").modal()},l=function(){return c(),jQuery("#win-text #winner").css("color",t[connect4.player-1]),jQuery("#win-text #winner").text(connect4.player),jQuery("#win-modal").modal({backdrop:"static",keyboard:!1})},p=function(){var t;return t=connect4.turns.pop(),null!=t?(connect4.grid[t.x][t.y]=0,connect4.cache[t.x]-=1,c()):void 0},d=function(){return o(),connect4.game.reset()},r=function(){return jQuery('.game-modal button[name="restart"]').click(d)},s=function(t,a){return t>=0&&e>t&&a>=0&&n>a},a=function(t,e,n,a){var i,o,r;return connect4.finished?!0:null==t&&null==e?!1:(r=connect4.grid[t][e],o=1,i=function(t,e,n,a){for(t+=n,e+=a;s(t,e)&&connect4.grid[t][e]===r&&4!==o;)o+=1,t+=n,e+=a},i(t,e,n,a),4!==o&&i(t,e,-1*n,-1*a),4===o)},c=function(t,e){return connect4.player=1===connect4.player?2:1,null!=t&&null!=e?connect4.turns.push({x:t,y:e}):void 0},jQuery(document).ready(g)}.call(this);